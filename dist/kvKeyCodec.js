// deno-lint-ignore-file
var S=Object.defineProperty;var c=(t,e)=>S(t,"name",{value:e,configurable:!0});var I=c((t,e)=>{if(typeof e=="bigint"){let n=BigInt(0);if(e===n)t.appendByte(20);else{let o=e<n,r=(o?-e:e).toString(16),i=R((r.length%2===1?"0":"")+r),s=i.length;if(s>255)throw Error("Tuple encoding does not support bigints larger than 255 bytes.");if(o)for(let p=0;p<i.length;p++)i[p]=~i[p];s<=8?t.appendByte(20+(o?-s:s)):s<256&&(t.appendByte(o?11:29),t.appendByte(o?s^255:s)),t.appendBuffer(i)}}else throw new TypeError("Item must be BigInt")},"encodeBigInt");function N(t,e,n){let{p:o}=e;if(n>=11&&n<=29){let r=n-20,i=Math.abs(r);return e.p+=i,n===20?0:K(t,o,i,r<0)}else throw new TypeError(`Invalid tuple data: code ${n} ('${t}' at ${e})`)}c(N,"decodeBigInt");function K(t,e,n,o){let r=BigInt(0),i=0;for(let s=n-1;s>=0;--s){let p=t[e+s];o&&(p=~p&255),r+=BigInt(p)<<BigInt(i),i+=8}return o?-r:r}c(K,"decodeIt");function R(t){let e=new Uint8Array(Math.ceil(t.length/2));for(let n=0;n<e.length;n++)e[n]=parseInt(t.substr(n*2,2),16);return e}c(R,"fromHexString");function b(t){return typeof t=="bigint"}c(b,"isBigInt");var M=!0,k=!1;function U(t,e){t.appendByte(33);let n=new Uint8Array(8);G(n,e,0),t.appendBuffer(P(n,M))}c(U,"encodeDouble");function D(t){return P(t,k),Z(t,0)}c(D,"decodeDouble");function G(t,e,n){e=+e,n=n>>>0,F(t,e,n)}c(G,"writeDoubleBE");var E=8;function F(t,e,n){let o=52,r,i,s,p=E*8-o-1,h=(1<<p)-1,a=h>>1,f=0,y=E-1,u=-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(i=isNaN(e)?1:0,r=h):(r=Math.floor(Math.log(e)/Math.LN2),e*(s=Math.pow(2,-r))<1&&(r--,s*=2),r+a>=1?e+=f/s:e+=f*Math.pow(2,1-a),e*s>=2&&(r++,s/=2),r+a>=h?(i=0,r=h):r+a>=1?(i=(e*s-1)*Math.pow(2,o),r=r+a):(i=e*Math.pow(2,a-1)*Math.pow(2,o),r=0));o>=8;t[n+y]=i&255,y+=u,i/=256,o-=8);for(r=r<<o|i,p+=o;p>0;t[n+y]=r&255,y+=u,r/=256,p-=8);t[n+y-u]|=L*128}c(F,"ieeeWrite");function Y(t,e,n){let r,i,s=E*8-52-1,p=(1<<s)-1,h=p>>1,a=-7,f=n?E-1:0,y=n?-1:1,u=t[e+f];for(f+=y,r=u&(1<<-a)-1,u>>=-a,a+=s;a>0;r=r*256+t[e+f],f+=y,a-=8);for(i=r&(1<<-a)-1,r>>=-a,a+=52;a>0;i=i*256+t[e+f],f+=y,a-=8);if(r===0)r=1-h;else{if(r===p)return i?NaN:(u?-1:1)*(1/0);i=i+Math.pow(2,52),r=r-h}return(u?-1:1)*i*Math.pow(2,r-52)}c(Y,"ieeeRead");function Z(t,e){return e=e>>>0,Y(t,e,!1)}c(Z,"readDoubleBE");function P(t,e){if(e&&(t[0]&128)===128||!e&&!(t[0]&128))for(let n=0;n<t.length;n++)t[n]=~t[n];else t[0]^=128;return t}c(P,"adjustFloat");var l=class{constructor(e=32768){this.insertionPoint=0;this.size=e,this.flexBuff=new ArrayBuffer(e,{maxByteLength:e*1e3}),this.accumulator=new Uint8Array(this.flexBuff)}appendByte(e){this.requires(1),this.accumulator[this.insertionPoint++]=e}appendBuffer(e){let n=e.byteLength;this.requires(n),this.accumulator.set(new Uint8Array(e),this.insertionPoint),this.insertionPoint+=n}requires(e){if(this.accumulator.length<this.insertionPoint+e){let n=this.accumulator.byteLength;for(;n<this.insertionPoint+e;)n+=this.size*2;this.flexBuff.resize(n)}}extract(){return this.accumulator.slice(0,this.insertionPoint)}};c(l,"Accumulator");var z=c((t,e)=>{if(e===void 0)throw new TypeError("Packed element cannot be undefined");if(e===null)t.appendByte(0);else if(e===!1)t.appendByte(38);else if(e===!0)t.appendByte(39);else if(e.constructor===Uint8Array||typeof e=="string"){let n;typeof e=="string"?(n=new TextEncoder().encode(e),t.appendByte(2)):(n=e,t.appendByte(1));for(let o=0;o<n.length;o++){let r=n[o];t.appendByte(r),r===0&&t.appendByte(255)}t.appendByte(0)}else{if(Array.isArray(e))throw new Error("Nested Tuples are not supported!");if(typeof e=="number")U(t,e);else if(b(e))I(t,e);else throw new TypeError("Packed items must be an array!")}},"encodeKey");function _(t){if(t===void 0||Array.isArray(t)&&t.length===0)return new Uint8Array(0);if(!Array.isArray(t))throw new TypeError("pack must be called with an array");let e=new l;for(let n=0;n<t.length;n++)z(e,t[n]);return e.extract()}c(_,"packRawKey");function se(t){return Array.isArray(t)||(t=[t]),_(t)}c(se,"pack");function q(t,e){let n=t[e.p++],{p:o}=e;switch(n){case 38:return!1;case 39:return!0;case 1:{let r=new l;for(;o<t.length;o++){let i=t[o];if(i===0){if(o+1>=t.length||t[o+1]!==255)break;o++}r.appendByte(i)}return e.p=o+1,r.extract()}case 2:{let r=new l;for(;o<t.length;o++){let s=t[o];if(s===0){if(o+1>=t.length||t[o+1]!==255)break;o++}r.appendByte(s)}return e.p=o+1,new TextDecoder("utf-8").decode(r.extract().buffer)}case 33:{let r=new Uint8Array(8);for(let i=0;i<8;i++)r[i]=t[o+i];return e.p+=8,D(r)}default:{if(n>=11||n<=29)return N(t,e,n);throw new TypeError(`Invalid KvKey data: code ${n} ('${t}' at ${e})`)}}}c(q,"decodeKey");function ue(t){let e={p:0},n=[];for(;e.p<t.byteLength;)n.push(q(t,e));return n}c(ue,"unpack");export{se as pack,ue as unpack};
